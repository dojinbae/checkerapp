import streamlit as st
import requests
import re
from bs4 import BeautifulSoup

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(
    page_title="ê¸ˆì¹™ì–´ ê²€ì‚¬ê¸°",
    page_icon="ğŸ”",
    layout="centered"
)

# ê¸ˆì¹™ì–´ ë¦¬ìŠ¤íŠ¸
word_listf = [
    'ìŒê²€', 'ì´ì¹¼', 'ì°¸ì‚¬', 'ë°•ë„', 'ì§„ê²€', 'ë…ì¸', 'ì§ˆì‹¸', 'ì—¼íƒ', 'ë„ì²­', 'ì‚¬ì°°', 'ì±…ë™',
    'ì•”í‘œ', 'ì„¹íŒŒ', 'ë¬´ë‹¨', 'ì˜ì‚¬', 'ëˆ„ë“œ', 'ì—°ì´ˆ', 'ê¶ë ¨', 'ë‹´ë°°', 'êµ¬ì´ˆ', 'ê´€ì—°', 'ì˜ì´ˆ', 'ë§ˆì•½', 'ëŒ€ë§ˆ', 'ì•¼ë°”',
    'ì°¸ì‚¬', 'ê²½ë§ˆ', 'ë‚˜ê°€ìš”', 'í­ì•½', 'ì•¼ì‚¬', 'ì˜ë©´', 'ì‘ê³ ', 'ìµì‚¬', 'í”¼í', 'ì„ëª…', 'ì¡¸ì‚¬', 'ë³‘í', 'ì ë³´', 'ë§ˆë•…',
    'ì°¸ì‹œ', 'ëˆ„ë‘', 'ì• ë„', 'ì—ë„', 'ì•¼ë™', 'ë§ˆë‹¤', 'ë³‘ì‹ ', 'ì´ˆì§œ', 'ìŒë…', 'ê·¸ì', 'ì”¹ì§ˆ', 'ì• ë¬´', 'ì˜¤ë„',
    'ì²´ìœ„', 'ìŠ´ê°€', 'í­ì•½', 'í­íƒ„', 'í°ì„¹', 'í°ì…', 'í˜¸ë¹ ', 'í›„ì¥', 'ì„¹ì‹œ', 'ì”¨ë¹¨', 'ì•¼ë©', 'ì•¼ì‹œ', 'ì˜¤ëŸ´', 'ìœ í¥', 'ì ì§€',
    'ì¡´ë‚˜', 'ë…¸ëª¨', 'ë„ì´¬', 'ë ë°œ', 'ëª°ë˜', 'ëª°ì¹´', 'ë¯¸ì¹œ', 'ë²Œê¸°', 'ë²Œë ¤', 'ë³€ë…€', 'ë¹¨ì•„', 'ë¹¨ì–´', 'ì„±ë°©',
    'ë³€íƒœ', 'ìƒ‰ìŠ¤', 'ë™ê±°', 'ë¶ˆë¥œ', 'ì• ë¡œ', 'ì›ì¡°', 'ìµœê·¼', 'ì¥ë¬¼', 'ì¹´ì„¹', 'í°íŒ…', 'ì„¹ê³¨', 'ì„¹ë…€', 'ìŒ•ìŠ¤', 'í¨ë”', 'í¨ì„­',
    'ë¹ êµ´', 'ë»í‚¹', 'ë‚œêµ', 'ìƒ‰ì“°', 'ì„¹ì“°', 'í°ì…', 'ë¬¸ì„¹', 'ìš©ìƒ‰', 'ì›¬ë§Œ', 'ëŒ€ëµ', 'ë‚ ì´', 'ì‹¤ì œ', 'ì¡°ê¸ˆ',
    'ì§€ì†', 'ì—¬ëŸ¿', 'ì°', 'ëŒ€ë¶€ë¶„', 'ì§ˆì‚¬', 'ì•¼ì„¤', 'ë¹™ì‹ ', 'ë°œê¸°', 'ê·€ë‘', 'í˜íŒ…', 'í°ìƒ‰', 'ì„¹ë§ˆ', 'ì•¼ê²œ', 'ì•¼ê»¨', 'ì•¼ë˜¥',
    'ì•¼ì„¹', 'ìŒìš•', 'ìì¥', 'ì¬ë„', 'ì „ë¼', 'ì¢€ë¬¼', 'ì§¬ì§€', 'ì°Œì°Œ', 'ì²´ëª¨', 'ê¼¬ì¶”', 'ë–¡ê±¸', 'ë–¡ì´Œ', 'ë§ê¹Œ', 'ë³´ì§“', 'ë´‰ì•Œ',
    'ëµ¤ì§€', 'ë¶ˆì•Œ', 'ìƒ‰ê³¨', 'ì„¸ì—‘', 'ìœ¡ë´‰', 'ì‹¸ì£ ', 'ìŒ©ì‘ˆ', 'ì»´ì„¹', 'ìŒë€', 'ìƒ‰í°', 'ì…€ê±¸', 'ë©œì„­', 'ì„¹í• ',
    'ì¡ë…„', 'ì¬ë„', 'ì €ë…„', 'ë»˜ë…¸', 'ë½€ì§€', 'ë½ˆë…¸', 'ì„¹ì‘¤', 'ì»´ìƒ‰', 'í™”ê°„', 'ìŒê²½', 'ìŒí•µ', 'ë¹„ì—˜', 'ë³´ì§€', 'ìì§€', 'ì„±ê¸°',
    'ì•¼ìº ', 'ë‚˜ì²´', 'ìŒëª¨', 'ì˜¥ë¬¸', 'ê³ í™˜', 'ì •ì•¡', 'ìƒ‰ë§ˆ', 'ë§ê°€', 'ë…¸ì½˜', 'ì½˜ë”', 'ìŒíƒ•', 'ê±°ìœ ', 'ì°½ë…€', "ì•¼í•œ", "ì•¼í•´",
    "í• ë•Œ", "ë‹¤ë¥¸", 'ì—ë¡œ', 'ì‹œì‹ ', 'ê°€ì¥', 'ë…„', 'ë‹¤ì–‘', 'ë¶€ì¡±', 'í•¸í”Œ', 'ì„¸ì›Œ', 'ì¸ë¶„', 'ì‹¤ì²œ', 'ë¸”ë¡œê·¸ë§ˆì¼€íŒ…',
    'ì•Š', 'ì´ë°˜', 'í…ê°€', 'ëŒ€ë”¸', 'ì¸ë§ˆ', 'ì°¸ìˆ˜', 'ì •ì‚¬', 'ìŒë¶€', 'ë„ì¶”', 'ì„±êµ', 'ê°•ê°„', 'ìˆ˜ê°„', 'ê°„ì‚¬', "ë³´ë‚´ì£ ",
    'ë’¤ì ¸', 'ìì‚´', 'ììœ„', 'ì§€ë°œ', 'ê°€ì˜¤', 'ì•„ë‹¤', 'ë¹ ê°€', 'ì”¹', 'í•œê±°', 'ì‚´ìƒ', 'ì‚´ìœ¡', 'í…ŒëŸ¬', 'ë‚œì', 'ë„ˆë¬´',
    'ë‹¹ì—°', 'ê°€ì§ˆ', 'ì—¬ê·¼', 'ë¹„ì¶”', 'ì‹ì¸', 'ì˜¥ë£¨', 'í•™ì‚´', 'ìŒì„œ', 'ìˆ˜ìŒ', 'ì‚¬ì˜', 'ìƒê°„', 'ìœ ì‚´', 'ì„¹ìˆ˜', 'ìì§„',
    'ì„¹ìˆ˜', 'ìš”ì ˆ', 'ì ˆì‚¬', 'ìš”í•¨', 'êµ­ë¶€', 'ê²Œì´', 'ë‚¨ìƒ‰', 'íŒŒì •', 'ê²Œë„¤', 'ë°¤ì¼', 'ìê²°', 'ë”œë„', 'ê°ˆë³´', 'ì‚´ìœ¡',
    'ì²™ì‚´', 'ì••ì‚´', 'ì‹œì—­', 'ì—­ì‚´', 'í™œì‚´', 'ìœ ì‚´', 'ë¶ˆêµ¬', 'ìƒ‰ë…€', 'ëŒ€ë²”', 'ë„ë²”', 'ì „ë²”', 'í˜¼ìŒ', 'ìœ¤ê°„', 'ëŠ¥ìš•', 'ì•¼ë°”',
    'ì•„í¸', 'ì• ì•¡', 'í€´ì–´', 'ì‚´ì¸', 'ì°½ê¸°', 'ì¶˜ë¶€', 'í¬ì£¼', 'ì¹¨ë…¸', 'ì·¨í•œ', 'ì•¼ì–‘', 'ê²¨ì›…', 'íšŒì‹ ',
    'ê³ 2', 'ê³ 1', 'ê³ 3', 'ê³„ëª¨', 'ì²˜ì', 'ê³¼ë¹„', 'ë–¨', 'ê°í•˜', 'ê³„ë¶€', 'íŒ¸', 'ê°€ê²°', 'ê°€ë“í•œ', 'ê°€ì–´',
    'ê°ì •ì´', 'ê°•ì„', 'ê°™ë„¤', 'ê²ƒë„', 'ê²ƒì€', 'ê²Œìœ¼ë¥¸', 'ê²©í•˜', 'ê²°ì—¬', 'ê³ë“¤ì¸', 'ê´€ë ¨', 'ê·¸ë§Œí¼', 'ê·¸ë¶„', 'ê·¸ì—', 'ê¼¬ë¬¼',
    'ëŠê³ ', 'ë‚˜ë¼ëŠ”ë§', 'ë‚«ë‹¤', 'ë‚´ë¦´', 'ë‚´ë¸”ë¡œê·¸', 'ë‚´ì—ì„œ', 'ë‚´ìš©ì€', 'ë„¤ì´ë²„ì—', 'ë†’ë‹¤', 'ëŠë¼ëŠ”', 'ëŠë¦¿', 'ë‹¤ë„¤ì´ë²„',
    'ë‹«ëŠ”', 'ë‹´ì„', 'ë”ìœ„', 'ë¼ê¸°', 'ë¼ì•¼', 'ë˜ëŠ”ê²ƒ', 'ë˜ì§€', 'ë“£ê³ ', 'ë“¤ì¸', 'ë¡œì¶”', 'ë¥˜ìš”', 'ë§ë‹¤', 'ë¨¸ë¬¼', 'ë©í•œ', 'ë©°ë¯¸',
    'ëª©í•˜', 'ë°”ë¡œí‚¤', 'ë°©ê¸ˆ', 'ë°°ì›Œ', 'ë³‘ì„', 'ë³´ë‚´ì„¸ìš”', 'ë¶„ë¬¸', 'ì‚¬ëŠ”', 'ì‚¬ëŒì´', 'ì‚¶ì—', 'ìƒìœ„ë…¸ì¶œ', 'ìŠ¬í””ì—', 'ìŠµë“', 'ì‹œì„œ',
    'ì‹œì²­', 'ì‹ ì¤‘', 'ì•ˆì—ë‹¤', 'ì–´ë‹¤', 'ì–´ë–¤ê²½ìš°', 'ì–´ë ¤ì›Œ', 'ì–´ë¥´', 'ì—ëŒ€í•œ', 'ì—ë“¤', 'ì—ìœ ', 'ì—¬ë‰´', 'ì—¬ì´', 'ì˜ˆë¯¼í•˜ê²Œ', 'ì™€í•¨ê»˜',
    'ì™„ë£Œ', 'ì™„ë²½', 'ìš±í•˜ëŠ”', 'ìš¸í•˜', 'ì›Œìš°', 'ì›ë˜', 'ìœ„í•´ì„œ', 'ìœ ë‚œ', 'ì˜ì™¸ë¡œ', 'ì´ê²ƒ', 'ì´ë‚´ì—', 'ì´ìƒì„', 'ì´ì–´ì§', 'ì½ì—ˆë‹¤',
    'ìˆëŠ”ì§€', 'ì¬ë°©', 'ì¬ì˜', 'ì €í•˜', 'ì •ì‹ ì ', 'ì œì˜', 'ì¤„ê³ ', 'ì§€ë‹Œ', 'ì±™ê²¨', 'ì¶©ë¶„íˆ', 'ì¹œêµ¬ê°€', 'ì¹¨ì—', 'ì»¤ë®¤', 'íŒë°•', 'í¬í•¨',
    'ìˆ™í•œ', 'ì œë¶€', 'ì—„ì²­', 'ë¬´ë£Œ', 'ìµœê³ ', 'ìµœì´ˆ', 'ë¬´ì²™', 'ê°•ì¶”', 'ì¶”ì²œ', 'ë˜ê²Œ', 'ë°œê¸°', 'ì½˜ë”', 'ì•¼ì‹¸', 'ë§Œëƒ¥',
    'ì½˜ë”', 'ë¶€ë¶„', 'ì´ˆì ', 'ì²´íŒ…ë°©', 'ì°íˆ°', 'í•‘ë‘', 'ì˜¥ë§', 'í‘œì ', 'ë‚´ëˆë‚´ì‚°', 'ìµœì €ê°€', 'ì¢‹ì•„ìš”', 'ë¹„ì‹¸ë‹¤', 'ì‹«ì–´ìš”',
    'íš¨ê³¼', 'ì˜ˆìœ', 'ë©‹ì§„', 'ê¸°ì¤€', 'ì„±ì¸ìš©', 'ì„±ê¸°êµ¬', 'ì„±ìƒí™œ', 'ì„±ë„êµ¬', 'ì„±ìš©í’ˆ', 'ê¶Œì¥',
    'ì°½í”¼í•´', 'ì•¼ì˜¤ì´', 'í•™ìƒ', 'ì¢‹ìŠµë‹ˆë‹¤', 'ì£¼ì„¸ìš”', 'í•˜ì„¸ìš”', 'ê°ˆìˆ˜', 'ê±¸ë¦¼', 'ê²°í•', 'ë©ë‹ˆë‹¤', 'ê²ë‹ˆë‹¤', 'ìŠµë‹ˆë‹¤',
    'ê·¸ëŸ¼', 'ê¸°ì—', 'ë‚˜ë•Œ', 'ë‚´ëŠ”', 'ë„˜ì–´', 'ë†“ì¹˜', 'ë”°ë¼', 'ê°€ëŠ¥', 'ë“¤ì–´', 'ë“¤ì—ˆ', 'ë“¤ì„', 'ê°™ìŠµë‹ˆë‹¤', 'ë“œë¦´ê²Œìš”',
    'ì²œê±°', 'ë“œë¦½ë‹ˆë‹¤', 'ë°œë¼', 'ë„£ì–´', 'í›„í‡´', 'í™œë°œ', 'í˜¹ì€', 'êµ¬ê±´', 'ê³¼ì „', 'íŠ¹ì •', 'ì¶”ì§„', 'ì³ì¤˜', 'ê²Œëª¨', 'ì‹¤ë¬¼',
    'ì²˜í•˜', 'ì£¼ì¤‘', 'ë‚˜ì´', 'í•´ìƒˆ', 'í•¨ì´', 'í•œë³€', 'ê°œì”©', 'ê°ì§€', 'ê°€í¸', 'í•„ìš”', 'í¼ì³', 'ì£¼ê²Œ',
    'ì „ì ', 'ì €í¬', 'ìˆì–´', 'ì¸ê·¼', 'ì´ì²˜', 'ì´ì£ ', 'ë¬´ìŠ¨', 'ë§ì´', 'ë ¤ê³ ', 'ë– ë‚˜', 'ì›ì¸', 'ì™¸ë¡­', 'ë ë•Œ',
    'ë™ì„', 'ë°ì—', 'ë‹¤ë…€', 'ì˜¤ëœ', 'ì–»ì–´', 'ì–´ë‚˜', 'ì•¼ì¶”', 'ì•Šê²Œ', 'ì‹¬í•œ', 'ì„±ìœ¼', 'ë¹ ë¥¸', 'ë¹ ë¥´', 'ë¶„í•œ', 'ë¶€í„°',
    'ë³´ì…', 'ë³€í™”', 'ë•ŒëŠ”', 'ê³¼ì—', 'ê³ ì³', 'ëŠ¦ì€', 'ëŠ”ì§€', 'ëŠìŠ¨', 'ë‡Œê°€', 'ë†’ì´', 'ë‚´ìš©', 'ì¥ë¡€'
]


def clean_text(input_string):
    """íŠ¹ìˆ˜ë¬¸ì ì œê±°"""
    text_rmv = re.sub(r'[-=+,#/\?:^.@*\"â€»~ã†!ã€' |\(\)\[\]$`\'â€¦%&><ã€‹\"\"\'Â·.~_;]', ' ', input_string)
    return text_rmv


def process_blog_text(text):
    """ë¸”ë¡œê·¸ í…ìŠ¤íŠ¸ ë¶„ì„"""
    # í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬
    linea1 = text.replace("\n", "").replace("ì¶œì²˜ ì…ë ¥", "").replace("ì‚¬ì§„ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”", "")
    linea2 = str(linea1)
    line1 = clean_text(linea2)
    line2 = line1.replace(" ", "")

    # ê¸ˆì¹™ì–´ ê²€ì‚¬
    penlistf = []
    for word in sorted(word_listf):
        count = line2.count(word)
        if count > 0:
            penlistf.append({"word": word, "count": count})

    # ì´ ê¸€ììˆ˜
    total_chars = len(line2)

    return {
        "cleaned_text": line2,
        "total_chars": total_chars,
        "penlistf": penlistf
    }


def process_blog_url(url):
    """ë¸”ë¡œê·¸ URLì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ"""
    # ëª¨ë°”ì¼ URLë¡œ ë³€ê²½
    if 'm.blog' not in url:
        url = url.replace('blog', 'm.blog')

    try:
        response = requests.get(url, timeout=10)
        response.raise_for_status()
    except Exception as e:
        return {"error": f"URL ìš”ì²­ ì‹¤íŒ¨: {e}"}

    soup = BeautifulSoup(response.text, "html.parser")
    container = soup.select_one("div.se-main-container")

    if container is None:
        return {"error": "ë¸”ë¡œê·¸ ë³¸ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. URLì„ í™•ì¸í•´ì£¼ì„¸ìš”."}

    text = container.get_text().replace("\n", "")
    return process_blog_text(text)


# ==================== ë©”ì¸ ì•± ====================
st.title("ğŸ” ê¸ˆì¹™ì–´ ê²€ì‚¬ê¸°")

# ë©”ì¸ í‚¤ì›Œë“œ ì…ë ¥
main_keyword = st.text_input("ë©”ì¸ í‚¤ì›Œë“œ (ì„ íƒ)", placeholder="ì˜ˆ: ë‹¤ì´ì–´íŠ¸")

# ì…ë ¥ ë°©ì‹ ì„ íƒ
input_mode = st.radio("ì…ë ¥ ë°©ì‹", ("ë¸”ë¡œê·¸ URL", "ì§ì ‘ ì…ë ¥"), horizontal=True)

st.markdown("---")

# URL ì…ë ¥ ëª¨ë“œ
if input_mode == "ë¸”ë¡œê·¸ URL":
    blog_url = st.text_input("ë¸”ë¡œê·¸ URL", placeholder="https://blog.naver.com/...")

    if st.button("ë¶„ì„ ì‹œì‘", type="primary"):
        if blog_url:
            with st.spinner("ë¶„ì„ ì¤‘..."):
                result = process_blog_url(blog_url)

            if "error" in result:
                st.error(result["error"])
            else:
                # ê¸°ë³¸ ì •ë³´
                col1, col2, col3 = st.columns(3)
                with col1:
                    st.metric("ì´ ê¸€ììˆ˜", f"{result['total_chars']:,}ì")
                with col2:
                    if main_keyword:
                        keyword_clean = main_keyword.replace(" ", "")
                        keyword_count = result["cleaned_text"].count(keyword_clean)
                        st.metric("ë©”ì¸í‚¤ì›Œë“œ", f"{keyword_count}íšŒ")
                with col3:
                    st.metric("ê¸ˆì¹™ì–´ ì¢…ë¥˜", f"{len(result['penlistf'])}ê°œ")

                st.markdown("---")

                # ê¸ˆì¹™ì–´ ê²€ì‚¬ ê²°ê³¼
                st.subheader("ê¸ˆì¹™ì–´ ê²€ì‚¬ ê²°ê³¼")
                if result["penlistf"]:
                    st.warning(f"{len(result['penlistf'])}ê°œì˜ ê¸ˆì¹™ì–´ ë°œê²¬!")
                    for item in result["penlistf"]:
                        st.write(f"â€¢ **{item['word']}**: {item['count']}íšŒ")
                else:
                    st.success("âœ… ê¸ˆì¹™ì–´ ì—†ìŒ")

                # ì›ë³¸ í…ìŠ¤íŠ¸
                with st.expander("ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ ë³´ê¸°"):
                    st.text_area("", result["cleaned_text"], height=200)
        else:
            st.warning("URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”")

# í…ìŠ¤íŠ¸ ì§ì ‘ ì…ë ¥ ëª¨ë“œ
else:
    blog_text = st.text_area("í…ìŠ¤íŠ¸ ì…ë ¥", height=300, placeholder="ë¸”ë¡œê·¸ ê¸€ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...")

    if st.button("ë¶„ì„ ì‹œì‘", type="primary"):
        if blog_text:
            with st.spinner("ë¶„ì„ ì¤‘..."):
                result = process_blog_text(blog_text)

            # ê¸°ë³¸ ì •ë³´
            col1, col2, col3 = st.columns(3)
            with col1:
                st.metric("ì´ ê¸€ììˆ˜", f"{result['total_chars']:,}ì")
            with col2:
                if main_keyword:
                    keyword_clean = main_keyword.replace(" ", "")
                    keyword_count = result["cleaned_text"].count(keyword_clean)
                    st.metric("ë©”ì¸í‚¤ì›Œë“œ", f"{keyword_count}íšŒ")
            with col3:
                st.metric("ê¸ˆì¹™ì–´ ì¢…ë¥˜", f"{len(result['penlistf'])}ê°œ")

            st.markdown("---")

            # ê¸ˆì¹™ì–´ ê²€ì‚¬ ê²°ê³¼
            st.subheader("ê¸ˆì¹™ì–´ ê²€ì‚¬ ê²°ê³¼")
            if result["penlistf"]:
                st.warning(f"{len(result['penlistf'])}ê°œì˜ ê¸ˆì¹™ì–´ ë°œê²¬!")
                for item in result["penlistf"]:
                    st.write(f"â€¢ **{item['word']}**: {item['count']}íšŒ")
            else:
                st.success("âœ… ê¸ˆì¹™ì–´ ì—†ìŒ")

            # ì›ë³¸ í…ìŠ¤íŠ¸
            with st.expander("ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ ë³´ê¸°"):
                st.text_area("", result["cleaned_text"], height=200)
        else:
            st.warning("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")